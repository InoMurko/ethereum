defmodule ExRLP.ProtocolsTest do
  use ExUnit.Case
  alias ExRLP.LogEntry

  @log_entry LogEntry.new(
               <<15, 87, 46, 82, 149, 197, 127, 21, 136, 111, 155, 38, 62, 47, 109, 45, 108, 123,
                 94, 198>>,
               [0, 0, 0],
               <<255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
                 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255>>
             )

  describe "encode/2" do
    test "encodes custom struct" do
      expected_result =
        <<248, 58, 148, 15, 87, 46, 82, 149, 197, 127, 21, 136, 111, 155, 38, 62, 47, 109, 45,
          108, 123, 94, 198, 195, 128, 128, 128, 160, 255, 255, 255, 255, 255, 255, 255, 255, 255,
          255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
          255, 255, 255, 255, 255, 255>>

      assert ExRLP.encode(@log_entry) == expected_result
    end

    test "encodes custom struct in list" do
      expected_result =
        <<248, 60, 248, 58, 148, 15, 87, 46, 82, 149, 197, 127, 21, 136, 111, 155, 38, 62, 47,
          109, 45, 108, 123, 94, 198, 195, 128, 128, 128, 160, 255, 255, 255, 255, 255, 255, 255,
          255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
          255, 255, 255, 255, 255, 255, 255, 255>>

      assert ExRLP.encode([@log_entry]) == expected_result
    end
  end
end
